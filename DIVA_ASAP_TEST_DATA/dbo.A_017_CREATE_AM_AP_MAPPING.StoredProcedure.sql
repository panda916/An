USE [DIVA_ASAP_TEST_DATA]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[A_017_CREATE_AM_AP_MAPPING]
AS
BEGIN
-- Step 1 Create an AM table for AP clearing account
EXEC SP_DROPTABLE 'AM_AP_CLEARING'
		SELECT 
			DISTINCT
			SKAT_SAKNR AS ZF_ACCOUNT,
			SKAT_TXT20,
			SKAT_TXT50,
			'' AS ZF_AP_CLEARING
			INTO AM_AP_CLEARING
		FROM A_SKAT
			INNER JOIN 
			(
				SELECT DISTINCT T001_KTOPL
				FROM A_T001
				INNER JOIN AM_SCOPE
				ON T001_BUKRS=AM_SCOPE.SCOPE_CMPNY_CODE
			) AS B
			ON SKAT_KTOPL=T001_KTOPL
			WHERE EXISTS
			(
				SELECT TOP 1 1
				FROM A_ACDOCA
				WHERE SKAT_SAKNR=ACDOCA_RACCT
			)
END
GO
