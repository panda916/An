USE [DIVA_ASAP_TEST_DATA]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

--ALTER PROCEDURE [dbo].[[SP_TABLE_REC_INFO]]
CREATE PROCEDURE [dbo].[SP_TABLE_REC_INFO_TEST]
AS

/* Initialize parameters from globals table */

     DECLARE 	 
			 @currency nvarchar(max)			= (SELECT [GLOBALS_VALUE] FROM [AM_GLOBALS] WHERE [GLOBALS_PARAMETER] = 'currency')
			,@date1 nvarchar(max)				= (SELECT [GLOBALS_VALUE] FROM [AM_GLOBALS] WHERE [GLOBALS_PARAMETER] = 'date1')
			,@date2 nvarchar(max)				= (SELECT [GLOBALS_VALUE] FROM [AM_GLOBALS] WHERE [GLOBALS_PARAMETER] = 'date2')
			,@downloaddate nvarchar(max)		= (SELECT [GLOBALS_VALUE] FROM [AM_GLOBALS] WHERE [GLOBALS_PARAMETER] = 'downloaddate')
			,@exchangeratetype nvarchar(max)	= (SELECT [GLOBALS_VALUE] FROM [AM_GLOBALS] WHERE [GLOBALS_PARAMETER] = 'exchangeratetype')
			,@language1 nvarchar(max)			= (SELECT [GLOBALS_VALUE] FROM [AM_GLOBALS] WHERE [GLOBALS_PARAMETER] = 'language1')
			,@language2 nvarchar(max)			= (SELECT [GLOBALS_VALUE] FROM [AM_GLOBALS] WHERE [GLOBALS_PARAMETER] = 'language2')
			,@year nvarchar(max)				= (SELECT [GLOBALS_VALUE] FROM [AM_GLOBALS] WHERE [GLOBALS_PARAMETER] = 'year')
			,@id nvarchar(max)					= (SELECT [GLOBALS_VALUE] FROM [AM_GLOBALS] WHERE [GLOBALS_PARAMETER] = 'id')
			,@ZV_LIMIT nvarchar(max)		    = (SELECT [GLOBALS_VALUE] FROM [AM_GLOBALS] WHERE [GLOBALS_PARAMETER] = 'ZV_LIMIT')


/* Drop table if it already exists*/

EXEC sp_droptable 'LOG_TABLE_INFO'

CREATE TABLE [DBO].[LOG_TABLE_INFO] ([SP_NAME] NVARCHAR(MAX) NULL, [SP_TABLE] NVARCHAR(MAX) NULL, 
	REC_COUNT MONEY NULL,[SUM_POS] MONEY NULL, [SUM_NEG] MONEY NULL, SUM_FIELD NVARCHAR(MAX), KEY_FIELD NVARCHAR(MAX), QUERY_TIME DATETIME, ID INT IDENTITY(1, 1)) 
--Step 1: Check duplication for SAP table _IT_ table

EXEC SP_TABLE_REC_INFO 'B01_01_IT_USERS'
EXEC SP_TABLE_REC_INFO 'B02_04_IT_FIN_COA'
EXEC SP_TABLE_REC_INFO 'B03_03_IT_FIN_TB'
EXEC SP_TABLE_REC_INFO 'B04_11_IT_FIN_GL'
EXEC SP_TABLE_REC_INFO 'B05_02_IT_FIN_MJE'
EXEC SP_TABLE_REC_INFO 'B06_01_IT_GIN_GL_SUMMARY'
EXEC SP_TABLE_REC_INFO 'B08_06_IT_PTP_SMD'
EXEC SP_TABLE_REC_INFO 'B09_13_IT_PTP_POS'
EXEC SP_TABLE_REC_INFO 'B10_02_IT_PTP_PO_HISTORY'
EXEC SP_TABLE_REC_INFO 'B11_04_IT_PTP_APA'
EXEC SP_TABLE_REC_INFO 'B11_05_IT_PTP_INVS_AND_CANCS'
EXEC SP_TABLE_REC_INFO 'B11_07_IT_PTP_INV_CANC'
EXEC SP_TABLE_REC_INFO 'B11_06_IT_PTP_INV'
EXEC SP_TABLE_REC_INFO 'B11_09_IT_PTP_PAY_CANC'
EXEC SP_TABLE_REC_INFO 'B11_08_IT_PTP_PAY'
EXEC SP_TABLE_REC_INFO 'B11_09_IT_PTP_PAY_CANC'
EXEC SP_TABLE_REC_INFO 'B11_14_IT_AP_AGEING'


EXEC SP_TABLE_REC_INFO 'B12_02_IT_AP_PO_MAP_TABLE'
EXEC SP_TABLE_REC_INFO 'B13_05_IT_CMD'
EXEC SP_TABLE_REC_INFO 'B14_06_IT_ARE'
EXEC SP_TABLE_REC_INFO 'B14_19_IT_T4_OUTPUT'
EXEC SP_TABLE_REC_INFO 'B15_05_IT_ARE_CHANGES'
EXEC SP_TABLE_REC_INFO 'B16_04_IT_OTC_AR_AGEING'
EXEC SP_TABLE_REC_INFO 'B17_03_IT_INV_MMD'
EXEC SP_TABLE_REC_INFO 'B18B_08_IT_COPA_HIERARCHY_VALUE'
EXEC SP_TABLE_REC_INFO 'B18_09_IT_COPA_TRANSACTION'

SELECT * FROM [LOG_TABLE_INFO]
--SELECT TOP 10 B18_COPA_BUKRS, B18_COPA_GJAHR, B18_COPA_BELNR, B18_COPA_POSNR, B18_COPA_PALEDGER FROM B18_09_IT_COPA_TRANSACTION
--GROUP BY B18_COPA_BUKRS, B18_COPA_GJAHR, B18_COPA_BELNR, B18_COPA_POSNR
--HAVING COUNT(*) > 1
--SELECT * FROM B18_09_IT_COPA_TRANSACTION
--WHERE B18B_COPA_BUKRS = 'RU10' AND B18B_COPA_GJAHR = '2016' AND B18B_COPA_BELNR = '0001104288' AND B18B_COMA_M_Hierarchy_L1 = 'Gross Profit'
--SELECT * FROM zzSAP_DDIC..RUSSIA_DD03L WHERE TABNAME = 'LFB1' AND KEYFLAG <> 'NULL'





GO
