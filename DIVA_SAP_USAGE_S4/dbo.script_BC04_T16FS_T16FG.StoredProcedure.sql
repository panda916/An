USE [DIVA_SAP_USAGE_S4]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[script_BC04_T16FS_T16FG]
AS
--DYNAMIC_SCRIPT_START
BEGIN
--Script objective: Create the cube for realse strategy
--Step 1 Create Release trategy cube 

EXEC SP_DROPTABLE BC04_01_IT_T16FS_T16FG

SELECT DISTINCT 
--Release group informations
		T16FG_FRGGR,
		A_T16FG.T16FG_FRGOT,
		CASE WHEN T16FG_FRGOT='1' THEN 'Purchase requisition'
			WHEN T16FG_FRGOT='2' THEN 'Purchase order'
			WHEN T16FG_FRGOT='3' THEN 'Service acceptance'
			WHEN T16FG_FRGOT='3' THEN 'Reserve'
			ELSE 'Not found' END AS ZF_T16FG_FRGOT_DESC,
		A_T16FG.T16FG_FRGFG,
		A_T16FG.T16FG_FRGKL,
--Release strategy descriptions
		A_T16FT.T16FT_FRGXT,
--Add the release strategy informations
		A_T16FS.T16FS_MANDT,
		A_T16FS.T16FS_FRGGR,	
		A_T16FS.T16FS_FRGSX,	
		A_T16FS.T16FS_FRGC1,	
		A_T16FS.T16FS_FRGC2,	
		A_T16FS.T16FS_FRGC3,	
		A_T16FS.T16FS_FRGC4,	
		A_T16FS.T16FS_FRGC5,	
		A_T16FS.T16FS_FRGC6,	
		A_T16FS.T16FS_FRGC7,	
		A_T16FS.T16FS_FRGC8,	
		A_T16FS.T16FS_FRGEX
		,A_T16FH.T16FH_FRGGT
INTO BC04_01_IT_T16FS_T16FG
FROM
	 A_T16FS
LEFT JOIN A_T16FG
	ON T16FS_FRGGR=T16FG_FRGGR
--Add description for release strategy
LEFT JOIN A_T16FT
	ON T16FS_FRGGR=T16FT_FRGGR AND T16FS_FRGSX=T16FT_FRGSX
-- Add description for release group 
LEFT JOIN A_T16FH
	ON T16FG_FRGGR=T16FH_FRGGR AND T16FH_SPRAS='EN'

--Rename fields
EXEC SP_RENAME_FIELD 'BC04_01_', 'BC04_01_IT_T16FS_T16FG'
END


GO
