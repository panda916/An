USE [DIVA_SAP_USAGE_S4]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[script_SU37_SU57_Identify reconciliation accounts that allow for manual posting]
--Script objective :Identify reconciliation accounts that allow for manual posting
AS
--DYNAMIC_SCRIPT_START

--Step 1 Get the infomartion from GL account master
EXEC SP_DROPTABLE SU37_01_RT_SKB1_SKAT_T001
SELECT 
*
INTO SU37_01_RT_SKB1_SKAT_T001
FROM BC34_01_IT_SKB1_SKAT_T001

--Step 2 Get the information  about supplier master
--Add the flag to check if LFB1_AKONT found in SKB1 if SKB1_XINTB='X'

EXEC SP_DROPTABLE SU37_02_RT_LFB1_LFA1_T001_SKAT

SELECT DISTINCT
	LFB1_SPERR,
	A_LFB1.LFB1_LIFNR,
	LFB1_BUKRS,
	LFA1_NAME1,
	LFA1_LAND1,
	LFA1_SORTL,
	LFA1_XCPDK,
	LFA1_ERDAT,
	LFB1_AKONT,
	A_T001.T001_KTOPL,
	A_T001.T001_BUTXT,
	SKAT_TXT20,
	SKB1_MITKZ,
	SKB1_XINTB,
	SKB1_BUKRS,
	SKB1_SAKNR,
	ZF_SKB1_MITZ_DESCRIPTION,
	SKAT_TXT50,
	IIF(LFB1_AKONT='' AND LFB1_SPERR='','X','') AS ZF_LFB1_AKONT_SPERR_EQ_BLANK,
	IIF(ZF_COUNT_LFB1_AKONT_EQ_1_FLAG ='X' AND LEN(TRIM(LFB1_AKONT))=0, 'X','') AS ZF_LFB1_LIFNR_AKONT_EQ_BLANK
INTO SU37_02_RT_LFB1_LFA1_T001_SKAT
	FROM A_LFB1 LEFT JOIN A_LFA1 ON LFB1_LIFNR=LFA1_LIFNR
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001
	ON SKB1_BUKRS=LFB1_BUKRS AND LFB1_AKONT=SKB1_SAKNR
LEFT JOIN A_T001
	ON T001_BUKRS=LFB1_BUKRS 
LEFT JOIN 
(
	SELECT LFB1_LIFNR,'X' AS ZF_COUNT_LFB1_AKONT_EQ_1_FLAG
	FROM A_LFB1
	GROUP BY LFB1_LIFNR
	HAVING COUNT(DISTINCT LFB1_AKONT)=1
) AS B ON A_LFB1.LFB1_LIFNR=B.LFB1_LIFNR

--Step 3 Get the information about customer master
--Add the flag to check if KNB1_AKONT found in SKB1

EXEC SP_DROPTABLE SU37_03_RT_KNB1_KNA1_T001_SKAT

SELECT DISTINCT
	KNB1_SPERR,
	A_KNB1.KNB1_KUNNR,
	KNB1_BUKRS,
	KNA1_NAME1,
	KNA1_LAND1,
	KNA1_SORTL,
	KNA1_XCPDK,
	KNA1_ERDAT,
	KNB1_AKONT,
	A_T001.T001_KTOPL,
	A_T001.T001_BUTXT,
	SKAT_TXT20,
	SKB1_MITKZ,
	SKB1_XINTB,
	SKB1_BUKRS,
	SKB1_SAKNR,
	ZF_SKB1_MITZ_DESCRIPTION,
	SKAT_TXT50,
	IIF(KNB1_AKONT='' AND KNB1_SPERR='','X','') AS ZF_KNB1_AKONT_SPERR_EQ_BLANK,
	IIF(ZF_COUNT_KNB1_AKONT_EQ_1_FLAG ='X' AND LEN(TRIM(KNB1_AKONT))=0, 'X','') AS ZF_KNB1_KUNNR_AKONT_EQ_BLANK
INTO SU37_03_RT_KNB1_KNA1_T001_SKAT
	FROM A_KNB1 LEFT JOIN
	A_KNA1 ON KNB1_KUNNR=KNA1_KUNNR
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001
	ON SKB1_BUKRS=KNB1_BUKRS AND KNB1_AKONT=SKB1_SAKNR 
	LEFT JOIN A_T001
	ON T001_BUKRS=KNB1_BUKRS 
LEFT JOIN
(
	SELECT KNB1_KUNNR,'X' AS ZF_COUNT_KNB1_AKONT_EQ_1_FLAG
	FROM A_KNB1
	GROUP BY KNB1_KUNNR
	HAVING COUNT(DISTINCT KNB1_AKONT)=1
) AS B
	ON A_KNB1.KNB1_KUNNR=B.KNB1_KUNNR

--Step 3 Get the information about fix asster master
EXEC SP_DROPTABLE SU37_04_TT_ANLA_ANLB

SELECT BC37_04_RT_ANLA_ANLB.*,
	A_SKB1_KTANSW.SKAT_TXT20 AS ZF_SKB1_KTANSW_SKAT_TXT20,
	A_SKB1_KTANSW.SKB1_MITKZ AS ZF_SKB1_KTANSW_SKB1_MITKZ,
	A_SKB1_KTANSW.SKB1_XINTB AS ZF_SKB1_KTANSW_SKB1_XINTB, 
	A_SKB1_KTANSW.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTANSW_MITZ_DESCRIPTION,
	A_SKB1_KTANSW.SKAT_TXT50 AS ZF_SKB1_KTANSW_SKAT_TXT50,
	A_SKB1_KTANZA.SKAT_TXT20 AS ZF_SKB1_KTANZA_SKAT_TXT20,
	A_SKB1_KTANZA.SKB1_MITKZ AS ZF_SKB1_KTANZA_SKB1_MITKZ,
	A_SKB1_KTANZA.SKB1_XINTB AS ZF_SKB1_KTANZA_SKB1_XINTB, 
	A_SKB1_KTANZA.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTANZA_MITZ_DESCRIPTION,
	A_SKB1_KTANZA.SKAT_TXT50 AS ZF_SKB1_KTANZA_SKAT_TXT50,
	A_SKB1_KTERLW.SKAT_TXT20 AS ZF_SKB1_KTERLW_SKAT_TXT20,
	A_SKB1_KTERLW.SKB1_MITKZ AS ZF_SKB1_KTERLW_SKB1_MITKZ,
	A_SKB1_KTERLW.SKB1_XINTB AS ZF_SKB1_KTERLW_SKB1_XINTB, 
	A_SKB1_KTERLW.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTERLW_MITZ_DESCRIPTION,
	A_SKB1_KTERLW.SKAT_TXT50 AS ZF_SKB1_KTERLW_SKAT_TXT50,
	A_SKB1_KTMEHR.SKAT_TXT20 AS ZF_SKB1_KTMEHR_SKAT_TXT20,
	A_SKB1_KTMEHR.SKB1_MITKZ AS ZF_SKB1_KTMEHR_SKB1_MITKZ,
	A_SKB1_KTMEHR.SKB1_XINTB AS ZF_SKB1_KTMEHR_SKB1_XINTB, 
	A_SKB1_KTMEHR.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTMEHR_MITZ_DESCRIPTION,
	A_SKB1_KTMEHR.SKAT_TXT50 AS ZF_SKB1_KTMEHR_SKAT_TXT50,
	A_SKB1_KTMAHK.SKAT_TXT20 AS ZF_SKB1_KTMAHK_SKAT_TXT20,
	A_SKB1_KTMAHK.SKB1_MITKZ AS ZF_SKB1_KTMAHK_SKB1_MITKZ,
	A_SKB1_KTMAHK.SKB1_XINTB AS ZF_SKB1_KTMAHK_SKB1_XINTB, 
	A_SKB1_KTMAHK.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTMAHK_MITZ_DESCRIPTION,
	A_SKB1_KTMAHK.SKAT_TXT50 AS ZF_SKB1_KTMAHK_SKAT_TXT50,
	A_SKB1_KTMIND.SKAT_TXT20 AS ZF_SKB1_KTMIND_SKAT_TXT20,
	A_SKB1_KTMIND.SKB1_MITKZ AS ZF_SKB1_KTMIND_SKB1_MITKZ,
	A_SKB1_KTMIND.SKB1_XINTB AS ZF_SKB1_KTMIND_SKB1_XINTB, 
	A_SKB1_KTMIND.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTMIND_MITZ_DESCRIPTION,
	A_SKB1_KTMIND.SKAT_TXT50 AS ZF_SKB1_KTMIND_SKAT_TXT50,
	A_SKB1_KTREST.SKAT_TXT20 AS ZF_SKB1_KTREST_SKAT_TXT20,
	A_SKB1_KTREST.SKB1_MITKZ AS ZF_SKB1_KTREST_SKB1_MITKZ,
	A_SKB1_KTREST.SKB1_XINTB AS ZF_SKB1_KTREST_SKB1_XINTB, 
	A_SKB1_KTREST.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTREST_MITZ_DESCRIPTION,
	A_SKB1_KTREST.SKAT_TXT50 AS ZF_SKB1_KTREST_SKAT_TXT50,
	A_SKB1_KTAPFG.SKAT_TXT20 AS ZF_SKB1_KTAPFG_SKAT_TXT20,
	A_SKB1_KTAPFG.SKB1_MITKZ AS ZF_SKB1_KTAPFG_SKB1_MITKZ,
	A_SKB1_KTAPFG.SKB1_XINTB AS ZF_SKB1_KTAPFG_SKB1_XINTB, 
	A_SKB1_KTAPFG.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTAPFG_MITZ_DESCRIPTION,
	A_SKB1_KTAPFG.SKAT_TXT50 AS ZF_SKB1_KTAPFG_SKAT_TXT50,
	A_SKB1_KTAUFW.SKAT_TXT20 AS ZF_SKB1_KTAUFW_SKAT_TXT20,
	A_SKB1_KTAUFW.SKB1_MITKZ AS ZF_SKB1_KTAUFW_SKB1_MITKZ,
	A_SKB1_KTAUFW.SKB1_XINTB AS ZF_SKB1_KTAUFW_SKB1_XINTB, 
	A_SKB1_KTAUFW.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTAUFW_MITZ_DESCRIPTION,
	A_SKB1_KTAUFW.SKAT_TXT50 AS ZF_SKB1_KTAUFW_SKAT_TXT50,
	A_SKB1_KTAUFG.SKAT_TXT20 AS ZF_SKB1_KTAUFG_SKAT_TXT20,
	A_SKB1_KTAUFG.SKB1_MITKZ AS ZF_SKB1_KTAUFG_SKB1_MITKZ,
	A_SKB1_KTAUFG.SKB1_XINTB AS ZF_SKB1_KTAUFG_SKB1_XINTB, 
	A_SKB1_KTAUFG.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTAUFG_MITZ_DESCRIPTION,
	A_SKB1_KTAUFG.SKAT_TXT50 AS ZF_SKB1_KTAUFG_SKAT_TXT50,
	A_SKB1_KTANSG.SKAT_TXT20 AS ZF_SKB1_KTANSG_SKAT_TXT20,
	A_SKB1_KTANSG.SKB1_MITKZ AS ZF_SKB1_KTANSG_SKB1_MITKZ,
	A_SKB1_KTANSG.SKB1_XINTB AS ZF_SKB1_KTANSG_SKB1_XINTB, 
	A_SKB1_KTANSG.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTANSG_MITZ_DESCRIPTION,
	A_SKB1_KTANSG.SKAT_TXT50 AS ZF_SKB1_KTANSG_SKAT_TXT50,
	A_SKB1_KTANZG.SKAT_TXT20 AS ZF_SKB1_KTANZG_SKAT_TXT20,
	A_SKB1_KTANZG.SKB1_MITKZ AS ZF_SKB1_KTANZG_SKB1_MITKZ,
	A_SKB1_KTANZG.SKB1_XINTB AS ZF_SKB1_KTANZG_SKB1_XINTB, 
	A_SKB1_KTANZG.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTANZG_MITZ_DESCRIPTION,
	A_SKB1_KTANZG.SKAT_TXT50 AS ZF_SKB1_KTANZG_SKAT_TXT50,
	A_SKB1_KTVBAB.SKAT_TXT20 AS ZF_SKB1_KTVBAB_SKAT_TXT20,
	A_SKB1_KTVBAB.SKB1_MITKZ AS ZF_SKB1_KTVBAB_SKB1_MITKZ,
	A_SKB1_KTVBAB.SKB1_XINTB AS ZF_SKB1_KTVBAB_SKB1_XINTB, 
	A_SKB1_KTVBAB.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTVBAB_MITZ_DESCRIPTION,
	A_SKB1_KTVBAB.SKAT_TXT50 AS ZF_SKB1_KTVBAB_SKAT_TXT50,
	A_SKB1_KTVZU.SKAT_TXT20 AS ZF_SKB1_KTVZU_SKAT_TXT20,
	A_SKB1_KTVZU.SKB1_MITKZ AS ZF_SKB1_KTVZU_SKB1_MITKZ,
	A_SKB1_KTVZU.SKB1_XINTB AS ZF_SKB1_KTVZU_SKB1_XINTB, 
	A_SKB1_KTVZU.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTVZU_MITZ_DESCRIPTION,
	A_SKB1_KTVZU.SKAT_TXT50 AS ZF_SKB1_KTVZU_SKAT_TXT50,
	A_SKB1_KTVIZU.SKAT_TXT20 AS ZF_SKB1_KTVIZU_SKAT_TXT20,
	A_SKB1_KTVIZU.SKB1_MITKZ AS ZF_SKB1_KTVIZU_SKB1_MITKZ,
	A_SKB1_KTVIZU.SKB1_XINTB AS ZF_SKB1_KTVIZU_SKB1_XINTB, 
	A_SKB1_KTVIZU.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTVIZU_MITZ_DESCRIPTION,
	A_SKB1_KTVIZU.SKAT_TXT50 AS ZF_SKB1_KTVIZU_SKAT_TXT50,
	A_SKB1_KTRIZU.SKAT_TXT20 AS ZF_SKB1_KTRIZU_SKAT_TXT20,
	A_SKB1_KTRIZU.SKB1_MITKZ AS ZF_SKB1_KTRIZU_SKB1_MITKZ,
	A_SKB1_KTRIZU.SKB1_XINTB AS ZF_SKB1_KTRIZU_SKB1_XINTB, 
	A_SKB1_KTRIZU.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTRIZU_MITZ_DESCRIPTION,
	A_SKB1_KTRIZU.SKAT_TXT50 AS ZF_SKB1_KTRIZU_SKAT_TXT50,
	A_SKB1_KTARIZ.SKAT_TXT20 AS ZF_SKB1_KTARIZ_SKAT_TXT20,
	A_SKB1_KTARIZ.SKB1_MITKZ AS ZF_SKB1_KTARIZ_SKB1_MITKZ,
	A_SKB1_KTARIZ.SKB1_XINTB AS ZF_SKB1_KTARIZ_SKB1_XINTB, 
	A_SKB1_KTARIZ.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTARIZ_MITZ_DESCRIPTION,
	A_SKB1_KTARIZ.SKAT_TXT50 AS ZF_SKB1_KTARIZ_SKAT_TXT50,
	A_SKB1_KTVERK.SKAT_TXT20 AS ZF_SKB1_KTVERK_SKAT_TXT20,
	A_SKB1_KTVERK.SKB1_MITKZ AS ZF_SKB1_KTVERK_SKB1_MITKZ,
	A_SKB1_KTVERK.SKB1_XINTB AS ZF_SKB1_KTVERK_SKB1_XINTB, 
	A_SKB1_KTVERK.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTVERK_MITZ_DESCRIPTION,
	A_SKB1_KTVERK.SKAT_TXT50 AS ZF_SKB1_KTVERK_SKAT_TXT50,
	A_SKB1_KTCOAB.SKAT_TXT20 AS ZF_SKB1_KTCOAB_SKAT_TXT20,
	A_SKB1_KTCOAB.SKB1_MITKZ AS ZF_SKB1_KTCOAB_SKB1_MITKZ,
	A_SKB1_KTCOAB.SKB1_XINTB AS ZF_SKB1_KTCOAB_SKB1_XINTB, 
	A_SKB1_KTCOAB.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTCOAB_MITZ_DESCRIPTION,
	A_SKB1_KTCOAB.SKAT_TXT50 AS ZF_SKB1_KTCOAB_SKAT_TXT50,
	A_SKB1_KTENAK.SKAT_TXT20 AS ZF_SKB1_KTENAK_SKAT_TXT20,
	A_SKB1_KTENAK.SKB1_MITKZ AS ZF_SKB1_KTENAK_SKB1_MITKZ,
	A_SKB1_KTENAK.SKB1_XINTB AS ZF_SKB1_KTENAK_SKB1_XINTB, 
	A_SKB1_KTENAK.ZF_SKB1_MITZ_DESCRIPTION AS ZF_SKB1_KTENAK_MITZ_DESCRIPTION,
	A_SKB1_KTENAK.SKAT_TXT50 AS ZF_SKB1_KTENAK_SKAT_TXT50
INTO SU37_04_TT_ANLA_ANLB
FROM 
BC37_04_RT_ANLA_ANLB
--Check T095_KTANSW in SKB1
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTANSW ON T095_KTANSW=A_SKB1_KTANSW.SKB1_SAKNR AND A_SKB1_KTANSW.SKB1_BUKRS=ANLB_BUKRS  AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTANZA ON T095_KTANZA=A_SKB1_KTANZA.SKB1_SAKNR AND A_SKB1_KTANZA.SKB1_BUKRS=ANLB_BUKRS  AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTERLW ON T095_KTERLW=A_SKB1_KTERLW.SKB1_SAKNR AND A_SKB1_KTERLW.SKB1_BUKRS=ANLB_BUKRS AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTMEHR ON T095_KTMEHR=A_SKB1_KTMEHR.SKB1_SAKNR AND A_SKB1_KTMEHR.SKB1_BUKRS=ANLB_BUKRS  AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTMAHK ON T095_KTMAHK=A_SKB1_KTMAHK.SKB1_SAKNR AND A_SKB1_KTMAHK.SKB1_BUKRS=ANLB_BUKRS  AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTMIND ON T095_KTMIND=A_SKB1_KTMIND.SKB1_SAKNR AND A_SKB1_KTMIND.SKB1_BUKRS=ANLB_BUKRS AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTREST ON T095_KTREST=A_SKB1_KTREST.SKB1_SAKNR AND A_SKB1_KTREST.SKB1_BUKRS=ANLB_BUKRS AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTAPFG ON T095_KTAPFG=A_SKB1_KTAPFG.SKB1_SAKNR AND A_SKB1_KTAPFG.SKB1_BUKRS=ANLB_BUKRS  AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTAUFW ON T095_KTAUFW=A_SKB1_KTAUFW.SKB1_SAKNR AND A_SKB1_KTAUFW.SKB1_BUKRS=ANLB_BUKRS AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTAUFG ON T095_KTAUFG=A_SKB1_KTAUFG.SKB1_SAKNR AND A_SKB1_KTAUFG.SKB1_BUKRS=ANLB_BUKRS AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTANSG ON T095_KTANSG=A_SKB1_KTANSG.SKB1_SAKNR AND A_SKB1_KTANSG.SKB1_BUKRS=ANLB_BUKRS AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTANZG ON T095_KTANZG=A_SKB1_KTANZG.SKB1_SAKNR AND A_SKB1_KTANZG.SKB1_BUKRS=ANLB_BUKRS AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTVBAB ON T095_KTVBAB=A_SKB1_KTVBAB.SKB1_SAKNR AND A_SKB1_KTVBAB.SKB1_BUKRS=ANLB_BUKRS AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTVZU ON T095_KTVZU=A_SKB1_KTVZU.SKB1_SAKNR AND A_SKB1_KTVZU.SKB1_BUKRS=ANLB_BUKRS AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTVIZU ON T095_KTVIZU=A_SKB1_KTVIZU.SKB1_SAKNR AND A_SKB1_KTVIZU.SKB1_BUKRS=ANLB_BUKRS  AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTRIZU ON T095_KTRIZU=A_SKB1_KTRIZU.SKB1_SAKNR AND A_SKB1_KTRIZU.SKB1_BUKRS=ANLB_BUKRS AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTARIZ ON T095_KTARIZ=A_SKB1_KTARIZ.SKB1_SAKNR AND A_SKB1_KTARIZ.SKB1_BUKRS=ANLB_BUKRS  AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTVERK ON T095_KTVERK=A_SKB1_KTVERK.SKB1_SAKNR AND A_SKB1_KTVERK.SKB1_BUKRS=ANLB_BUKRS  AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTCOAB ON T095_KTCOAB=A_SKB1_KTCOAB.SKB1_SAKNR AND A_SKB1_KTCOAB.SKB1_BUKRS=ANLB_BUKRS  AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTENAK ON T095_KTENAK=A_SKB1_KTENAK.SKB1_SAKNR AND A_SKB1_KTENAK.SKB1_BUKRS=ANLB_BUKRS  AND T095_KTOGR IS NOT NULL
LEFT JOIN BC34_01_IT_SKB1_SKAT_T001 AS A_SKB1_KTNAIB ON T095_KTNAIB=A_SKB1_KTNAIB.SKB1_SAKNR AND A_SKB1_KTNAIB.SKB1_BUKRS=ANLB_BUKRS  AND T095_KTOGR IS NOT NULL


--Step 4 Change the cube to vertical table
EXEC SP_DROPTABLE SU37_05_XT_T095_VERTICAL

SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTANSW AS ZF_T095_GL_ACCT,'T095_KTANSW' AS ZF_T095_ORG_FIELD
,'Bal. sheet account: Acquisition and production costs' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTANSW_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTANSW_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTANSW_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTANSW_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB
INTO SU37_05_XT_T095_VERTICAL
FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTANZA AS ZF_T095_GL_ACCT,'T095_KTANZA' AS ZF_T095_ORG_FIELD
,'G/L account:down payments' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTANZA_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTANZA_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTANZA_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTANZA_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTERLW AS ZF_T095_GL_ACCT,'T095_KTERLW' AS ZF_T095_ORG_FIELD
,'Clearing account for revenue from asset sale' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTERLW_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTERLW_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTERLW_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTERLW_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTMEHR AS ZF_T095_GL_ACCT,'T095_KTMEHR' AS ZF_T095_ORG_FIELD
,'G/L account: asset retirement gain' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTMEHR_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTMEHR_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTMEHR_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTMEHR_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTMAHK AS ZF_T095_GL_ACCT,'T095_KTMAHK' AS ZF_T095_ORG_FIELD
,'Acct:Gain from asset retirement over APC (curr. not used)' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTMAHK_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTMAHK_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTMAHK_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTMAHK_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTMIND AS ZF_T095_GL_ACCT,'T095_KTMIND' AS ZF_T095_ORG_FIELD
,'G/L account for asset retirement loss' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTMIND_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTMIND_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTMIND_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTMIND_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTREST AS ZF_T095_GL_ACCT,'T095_KTREST' AS ZF_T095_ORG_FIELD
,'G/L account for net book value when scrapped' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTREST_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTREST_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTREST_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTREST_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTAPFG AS ZF_T095_GL_ACCT,'T095_KTAPFG' AS ZF_T095_ORG_FIELD
,'G/L account:Decimals from asset acquisition: not used' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTAPFG_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTAPFG_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTAPFG_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTAPFG_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTAUFW AS ZF_T095_GL_ACCT,'T095_KTAUFW' AS ZF_T095_ORG_FIELD
,'Reconciliation account: Revaluation' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTAUFW_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTAUFW_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTAUFW_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTAUFW_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTAUFG AS ZF_T095_GL_ACCT,'T095_KTAUFG' AS ZF_T095_ORG_FIELD
,'Offsetting account for revaluation' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTAUFG_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTAUFG_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTAUFG_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTAUFG_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTANSG AS ZF_T095_GL_ACCT,'T095_KTANSG' AS ZF_T095_ORG_FIELD
,'Contra account: Down payment posting' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTANSG_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTANSG_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTANSG_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTANSG_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTVBAB AS ZF_T095_GL_ACCT,'T095_KTVBAB' AS ZF_T095_ORG_FIELD
,'Clearing acct.revenue from sale to affiliated company' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTVBAB_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTVBAB_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTVBAB_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTVBAB_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTVZU AS ZF_T095_GL_ACCT,'T095_KTVZU' AS ZF_T095_ORG_FIELD
,'Clearing acct: Acquisition from affiliated company' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTVZU_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTVZU_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTVZU_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTVZU_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTVIZU AS ZF_T095_GL_ACCT,'T095_KTVIZU' AS ZF_T095_ORG_FIELD
,'Clearing account for allocation of investment support' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTVIZU_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTVIZU_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTVIZU_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTVIZU_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTRIZU AS ZF_T095_GL_ACCT,'T095_KTRIZU' AS ZF_T095_ORG_FIELD
,'Clearing account for repaying investment support' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTRIZU_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTRIZU_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTRIZU_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTRIZU_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTARIZ AS ZF_T095_GL_ACCT,'T095_KTRIZU' AS ZF_T095_ORG_FIELD
,'Expense account:Repayment of investment support' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTRIZU_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTRIZU_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTRIZU_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTRIZU_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTVERK AS ZF_T095_GL_ACCT,'T095_KTRIZU' AS ZF_T095_ORG_FIELD
,'G/L acct for costs of sale' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTRIZU_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTRIZU_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTRIZU_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTRIZU_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTENAK AS ZF_T095_GL_ACCT,'T095_KTRIZU' AS ZF_T095_ORG_FIELD
,'Revenue account for post-capitaliz. of asset' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTRIZU_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTRIZU_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTRIZU_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTRIZU_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
UNION
SELECT DISTINCT
ANLB_BUKRS,T095_AFABE,T095_KTOGR,T095_KTOPL,T001_BUTXT
,T095_KTNAIB AS ZF_T095_GL_ACCT,'T095_KTRIZU' AS ZF_T095_ORG_FIELD
,'Account for capitalization differences/nonoperating expense' AS ZF_T095_ORG_FIELD_DESC
,ZF_SKB1_KTRIZU_SKAT_TXT20 AS ZF_T095_GL_ACCT_DESC,ZF_SKB1_KTRIZU_SKB1_MITKZ AS ZF_T095_SKB1_MITKZ,ZF_SKB1_KTRIZU_MITZ_DESCRIPTION AS ZF_T095_SKB1_MITKZ_DESC
,ZF_SKB1_KTRIZU_SKB1_XINTB AS ZF_T095_GL_ACCT_XINTB FROM SU37_04_TT_ANLA_ANLB WHERE T095_AFABE IS NOT NULL
--Step 6 SPlit the cube for fixed asset master
EXEC SP_DROPTABLE SU37_06_RT_ANLA_ANLB

SELECT DISTINCT 
	ANLB_BUKRS,
	ANLB_ANLN1,
	ANLB_ANLN2,
	ANLB_AFABE,
	ANLB_BDATU,
	ANLA_BUKRS,
	ANLA_ANLN1,
	ANLA_ANLN2, 
	ANLA_ANLKL,
	ANLA_KTOGR,
	T001_BUTXT,
	T001_KTOPL,
	ANLB_XSPEB,
	IIF( 
		LEN(TRIM(T095_KTANSW))=0 AND
		LEN(TRIM(T095_KTANZA))=0 AND
		LEN(TRIM(T095_KTERLW))=0 AND
		LEN(TRIM(T095_KTMEHR))=0 AND
		LEN(TRIM(T095_KTMAHK))=0 AND
		LEN(TRIM(T095_KTMIND))=0 AND
		LEN(TRIM(T095_KTREST))=0 AND
		LEN(TRIM(T095_KTAPFG))=0 AND
		LEN(TRIM(T095_KTAUFW))=0 AND
		LEN(TRIM(T095_KTAUFG))=0 AND
		LEN(TRIM(T095_KTANSG))=0 AND
		LEN(TRIM(T095_KTANZG))=0 AND
		LEN(TRIM(T095_KTVBAB))=0 AND
		LEN(TRIM(T095_KTVZU))=0 AND
		LEN(TRIM(T095_KTVIZU))=0 AND
		LEN(TRIM(T095_KTRIZU))=0 AND
		LEN(TRIM(T095_KTARIZ))=0 AND
		LEN(TRIM(T095_KTVERK))=0 AND
		LEN(TRIM(T095_KTCOAB))=0 AND
		LEN(TRIM(T095_KTENAK))=0 AND
		LEN(TRIM(T095_KTNAIB))=0 AND LEN(TRIM(ANLB_XSPEB))=0,'X','') AS ZF_T095_GL_ANLB_XSPEB_EQ_BLANK
INTO 
SU37_06_RT_ANLA_ANLB
FROM 
SU37_04_TT_ANLA_ANLB


--Rename fields

EXEC SP_RENAME_FIELD 'SU37_01_',SU37_01_RT_SKB1_SKAT_T001
EXEC SP_RENAME_FIELD 'SU37_02_',SU37_02_RT_LFB1_LFA1_T001_SKAT
EXEC SP_RENAME_FIELD 'SU37_03_',SU37_03_RT_KNB1_KNA1_T001_SKAT
EXEC SP_RENAME_FIELD 'SU37_05_',SU37_05_XT_T095_VERTICAL
EXEC SP_RENAME_FIELD 'SU37_06_',SU37_06_RT_ANLA_ANLB

--Step 7 Get the movement transactions relate to suppliers that do not have reconcilation account setting
EXEC SP_DROPTABLE SU37_07_XT_FIN_GL_LFB1_AKONT_BLANK

SELECT DISTINCT B04_08_IT_FIN_GL.*,
IIF(B04_GL_ACDOCA_BUDAT<CDHDR_UDATE,'X','') AS ZF_ACDOCA_BUDAT_BEFORE_CDHDR_UDATE
INTO SU37_07_XT_FIN_GL_LFB1_AKONT_BLANK
FROM B04_08_IT_FIN_GL
INNER JOIN 
SU37_02_RT_LFB1_LFA1_T001_SKAT
ON SU37_02_LFB1_LIFNR=B04_GL_ACDOCA_LIFNR AND SU37_02_LFB1_AKONT='' AND SU37_02_LFB1_LIFNR IN
(
	SELECT SU37_02_LFB1_LIFNR
	FROM SU37_02_RT_LFB1_LFA1_T001_SKAT
	GROUP BY SU37_02_LFB1_LIFNR
	HAVING COUNT(DISTINCT SU37_02_LFB1_AKONT)=1
)
LEFT JOIN 
BC44_02_IT_CDHDR_CDPOS_KRED
ON CDHDR_OBJECTID=B04_GL_ACDOCA_LIFNR AND CDPOS_FNAME='AKONT'


--Step 8/ Get the movement transaction relate to customer that do not have reconcilation account setting
EXEC SP_DROPTABLE SU37_08_XT_FIN_GL_KNB1_AKONT_BLANK

SELECT DISTINCT B04_08_IT_FIN_GL.*,
IIF(B04_GL_ACDOCA_BUDAT<CDHDR_UDATE,'X','') AS ZF_ACDOCA_BUDAT_BEFORE_CDHDR_UDAT
INTO SU37_08_XT_FIN_GL_KNB1_AKONT_BLANK
FROM B04_08_IT_FIN_GL
INNER JOIN 
SU37_03_RT_KNB1_KNA1_T001_SKAT
ON SU37_03_KNB1_KUNNR=B04_GL_ACDOCA_KUNNR AND SU37_03_KNB1_AKONT='' AND SU37_03_KNB1_KUNNR IN
(
	SELECT SU37_03_KNB1_KUNNR
	FROM SU37_03_RT_KNB1_KNA1_T001_SKAT
	GROUP BY SU37_03_KNB1_KUNNR
	HAVING COUNT(DISTINCT SU37_03_KNB1_AKONT)=1
)
LEFT JOIN 
BC44_03_IT_CDHDR_CDPOS_DEBI
ON B04_GL_ACDOCA_KUNNR=CDHDR_OBJECTID  AND CDPOS_FNAME='AKONT'

--Step 9/ Get the movement transaction relate to asset that do not have reconcilation account setting
EXEC SP_DROPTABLE SU37_09_XT_FIN_GL_ANLA_ANLB_REC_ACCOUNT_BLANK

SELECT B04_08_IT_FIN_GL.*
INTO SU37_09_XT_FIN_GL_ANLA_ANLB_REC_ACCOUNT_BLANK
FROM B04_08_IT_FIN_GL
INNER JOIN SU37_04_TT_ANLA_ANLB
ON B04_GL_ACDOCA_ANLN1=ANLB_ANLN1 AND B04_GL_ACDOCA_ANLN2=ANLB_ANLN2
AND     LEN(TRIM(T095_KTANSW))=0 AND
		LEN(TRIM(T095_KTANZA))=0 AND
		LEN(TRIM(T095_KTERLW))=0 AND
		LEN(TRIM(T095_KTMEHR))=0 AND
		LEN(TRIM(T095_KTMAHK))=0 AND
		LEN(TRIM(T095_KTMIND))=0 AND
		LEN(TRIM(T095_KTREST))=0 AND
		LEN(TRIM(T095_KTAPFG))=0 AND
		LEN(TRIM(T095_KTAUFW))=0 AND
		LEN(TRIM(T095_KTAUFG))=0 AND
		LEN(TRIM(T095_KTANSG))=0 AND
		LEN(TRIM(T095_KTANZG))=0 AND
		LEN(TRIM(T095_KTVBAB))=0 AND
		LEN(TRIM(T095_KTVZU))=0 AND
		LEN(TRIM(T095_KTVIZU))=0 AND
		LEN(TRIM(T095_KTRIZU))=0 AND
		LEN(TRIM(T095_KTARIZ))=0 AND
		LEN(TRIM(T095_KTVERK))=0 AND
		LEN(TRIM(T095_KTCOAB))=0 AND
		LEN(TRIM(T095_KTENAK))=0 AND
		LEN(TRIM(T095_KTNAIB))=0 

--Step 10/ Get the change relate to supplier only
EXEC SP_DROPTABLE SU37_10_XT_CDHDR_CDPOS_KRED_SUPPLIER

SELECT DISTINCT BC44_02_IT_CDHDR_CDPOS_KRED.* 
INTO SU37_10_XT_CDHDR_CDPOS_KRED_SUPPLIER
FROM 
BC44_02_IT_CDHDR_CDPOS_KRED
INNER JOIN SU37_07_XT_FIN_GL_LFB1_AKONT_BLANK ON 
CDHDR_OBJECTID=B04_GL_ACDOCA_LIFNR AND CDPOS_FNAME='AKONT'

--Step 11/ Get the change relate to customer only
EXEC SP_DROPTABLE SU37_11_XT_CDHDR_CDPOS_DEBI_CUSTOMER

SELECT DISTINCT BC44_03_IT_CDHDR_CDPOS_DEBI.* 
INTO SU37_11_XT_CDHDR_CDPOS_DEBI_CUSTOMER
FROM 
BC44_03_IT_CDHDR_CDPOS_DEBI
INNER JOIN SU37_08_XT_FIN_GL_KNB1_AKONT_BLANK ON 
CDHDR_OBJECTID=B04_GL_ACDOCA_KUNNR AND  CDPOS_FNAME='AKONT'


--Rename the fields
EXEC SP_UNNAME_FIELD 'B04_GL_','SU37_07_XT_FIN_GL_LFB1_AKONT_BLANK'
EXEC SP_RENAME_FIELD 'SU37_07_','SU37_07_XT_FIN_GL_LFB1_AKONT_BLANK'

EXEC SP_UNNAME_FIELD 'B04_GL_','SU37_08_XT_FIN_GL_KNB1_AKONT_BLANK'
EXEC SP_RENAME_FIELD 'SU37_08_','SU37_08_XT_FIN_GL_KNB1_AKONT_BLANK'

EXEC SP_UNNAME_FIELD 'B04_GL_','SU37_09_XT_FIN_GL_ANLA_ANLB_REC_ACCOUNT_BLANK'
EXEC SP_RENAME_FIELD 'SU37_09_','SU37_09_XT_FIN_GL_ANLA_ANLB_REC_ACCOUNT_BLANK'

EXEC SP_RENAME_FIELD 'SU37_11_','SU37_11_XT_CDHDR_CDPOS_DEBI_CUSTOMER'
EXEC SP_RENAME_FIELD 'SU37_10_','SU37_10_XT_CDHDR_CDPOS_KRED_SUPPLIER'
GO
