USE [DIVA_GB00_FY23_24]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,> CREATE/UPDATE value for AM_FSMC mapping table.
-- =============================================
CREATE     PROCEDURE [dbo].[A_015_CREATE/UPDATE_AM_FSMC]
AS
BEGIN
	
-- Step 1 / Create AM_FSMC table
	EXEC SP_REMOVE_TABLES 'AM_FSMC'
	CREATE TABLE [dbo].[AM_FSMC](
		[FSMC_ID] [nvarchar](1000) NULL,
		[FSMC_NAME] [nvarchar](1000) NULL,
		[FSMC_CNTRY_CODE] [nvarchar](1000) NULL,
		[FSMC_REGION] [nvarchar](1000) NULL,
		[FSMC_CONTROLLING_AREA] [nvarchar](1000) NULL,
		[FSMC_COMPANY_CODE] [nvarchar](1000) NULL,
		[_FSMC_MANDT] [nvarchar](256) NULL
	)
-- Step 2 / Update value for RUSSIA and TURKEY
	IF CHARINDEX('RUSSIA', DB_NAME()) <> 0 
		BEGIN
			INSERT [dbo].[AM_FSMC] ([FSMC_ID], [FSMC_NAME], [FSMC_CNTRY_CODE], [FSMC_REGION], [FSMC_CONTROLLING_AREA], [FSMC_COMPANY_CODE], [_FSMC_MANDT]) VALUES (N'SCIS', N'Sony CIS', N'RUS', N'Russia', N'EU02', N'RU10', N'400')
			INSERT [dbo].[AM_FSMC] ([FSMC_ID], [FSMC_NAME], [FSMC_CNTRY_CODE], [FSMC_REGION], [FSMC_CONTROLLING_AREA], [FSMC_COMPANY_CODE], [_FSMC_MANDT]) VALUES (N'SUKR', N'Sony Ukraine', N'UKR', N'Ukraine', N'EU02', N'UA10', N'400')
		END
	ELSE IF CHARINDEX('TURKEY', DB_NAME()) <> 0
		BEGIN
			INSERT [dbo].[AM_FSMC] ([FSMC_ID], [FSMC_NAME], [FSMC_CNTRY_CODE], [FSMC_REGION], [FSMC_CONTROLLING_AREA], [FSMC_COMPANY_CODE], [_FSMC_MANDT]) VALUES (N'STUR', N'Sony Turkey', N'TUR', N'SCSE', N'EU04', N'TR10', N'400')
			INSERT [dbo].[AM_FSMC] ([FSMC_ID], [FSMC_NAME], [FSMC_CNTRY_CODE], [FSMC_REGION], [FSMC_CONTROLLING_AREA], [FSMC_COMPANY_CODE], [_FSMC_MANDT]) VALUES (N'STUR', N'Sony Turkey', N'TUR', N'SCSE', N'EU04', N'TR20', N'400')
		END
-- Step 3 / Insert new company from AM_SCOPE 
	INSERT INTO [dbo].[AM_FSMC](FSMC_COMPANY_CODE)
	SELECT 
		AM_SCOPE.SCOPE_CMPNY_CODE
	FROM AM_SCOPE
	LEFT JOIN AM_FSMC ON AM_SCOPE.SCOPE_CMPNY_CODE = AM_FSMC.FSMC_COMPANY_CODE
	WHERE  AM_FSMC.FSMC_COMPANY_CODE IS NULL
END
GO
