USE [DIVA_SAP_USAGE_ECC]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[script_BC05_T169G_ADD_FLAG]
AS
--DYNAMIC_SCRIPT_START
--Script objective: Create Tolerance Limits, Invoice Verification  cube

--Step 1 Create Tolerance Limits, Invoice Verification cube from T169G
--Get the upper and lower Tolerance Limit	
EXEC SP_DROPTABLE BC05_01_IT_T169G_ADD_FLAG

SELECT 
	T169G_MANDT,
	T169G_BUKRS,
	T169G_TOLSL,
	T169G_WERT1,
	T169G_XW1JA,
	T169G_XW1NE,
	T169G_WERT2,
	T169G_XW2JA,
	T169G_XW2NE,
	T169G_PROZ1,
	T169G_XP1JA,
	T169G_XP1NE,
	T169G_PROZ2,
	T169G_XP2JA,
	T169G_XP2NE,
	T169G_WAERS,
IIF(T169G_XW1JA='X' AND T169G_XW1NE='','X','') AS ZF_T169G_XW1JA_XW1NE_FLAG,
IIF(T169G_XW2JA='X' AND T169G_XW2NE='','X','') AS ZF_T169G_XW2JA_XW2NE_FLAG,
IIF(T169G_PROZ1<>T169G_PROZ2 OR (T169G_PROZ1=0 AND T169G_PROZ2=0),'X','') AS ZF_DIFF_PROZ1_PROZ2,
T001_BUTXT,T001_BUKRS,
IIF(T169G_BUKRS IS NULL OR LEN(TRIM(T169G_BUKRS))=0,'X','' ) AS ZF_T001_BUKRS_IS_BLANK,
T169S_TTEXT
INTO BC05_01_IT_T169G_ADD_FLAG
FROM A_T169G
--Add company code name
RIGHT JOIN A_T001 ON
T001_BUKRS=T169G_BUKRS
--Add tolerance key description
LEFT JOIN A_T169S ON
T169S_TOLSL=T169G_TOLSL AND T169S_SPRAS='EN'

--Rename the fields
EXEC SP_RENAME_FIELD 'BC05_01_','BC05_01_IT_T169G_ADD_FLAG'

GO
