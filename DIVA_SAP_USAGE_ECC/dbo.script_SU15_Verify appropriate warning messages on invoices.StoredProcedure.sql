USE [DIVA_SAP_USAGE_ECC]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[script_SU15_Verify appropriate warning messages on invoices]
AS
--DYNAMIC_SCRIPT_START

--Script objective : Verify appropriate warning messages on invoices

--Step 1 Get the result relate to Invoice verification setting
--Flag the case which have  relate to dupplicate invoice (T169P_XSPSO='X',T169P_XXBLNR='X',T169P_XBUKRS='X',T169P_XBLDAT='X',)
EXEC SP_DROPTABLE SU15_01_RT_T69P_T001_ADD_DUP_FLAG

SELECT
*,
IIF(BC27_01_T169P_XSPSO='X' AND 
	BC27_01_T169P_XXBLNR='X'AND 
	BC27_01_T169P_XBUKRS='X' AND BC27_01_T169P_XBLDAT='X',
	'X','')
AS ZF_T169P_XSPSO_XXBLNR_XBUKRS_XBLDAT_EQ_X
INTO SU15_01_RT_T69P_T001_ADD_DUP_FLAG
FROM BC27_01_IT_T69P_T001

--Step 2 Get the result for the user 
-- Flag the case in where T100C_ARBGB=F5,T100C_MSGNR=117 
--Arcording to RMS this is for duplicate invoice messaging
EXEC SP_DROPTABLE SU15_02_RT_T100C_T100_ADD_DUPP_FLAG

SELECT
	*,
	IIF( BC29_01_T100C_ARBGB='F5' AND BC29_01_T100C_MSGNR='117','X','' ) AS ZF_T100C_ARBGB_EQ_FE_MSGNR_EQ_117
INTO SU15_02_RT_T100C_T100_ADD_DUPP_FLAG
FROM BC29_01_IT_T100C_T100_T100T

--Rename the field
EXEC SP_UNNAME_FIELD 'BC27_01_','SU15_01_RT_T69P_T001_ADD_DUP_FLAG'
EXEC SP_RENAME_FIELD 'SU15_01_','SU15_01_RT_T69P_T001_ADD_DUP_FLAG'

EXEC SP_UNNAME_FIELD 'BC29_01_','SU15_02_RT_T100C_T100_ADD_DUPP_FLAG'
EXEC SP_RENAME_FIELD 'SU15_02_','SU15_02_RT_T100C_T100_ADD_DUPP_FLAG'

GO
